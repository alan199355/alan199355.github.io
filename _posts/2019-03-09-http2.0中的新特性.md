---
layout: post
title: "http2.0中的新特性"
date: 2019-03-09
author: "Yeqiang"
tags:
  - HTTP
---

### 二进制帧层
首先我们来了解下关于帧的知识
 - 帧：HTTP2.0通信的最小单位，所有帧都共享一个8字节的首部，其中包含帧的长度、类型、标志、还有一个保留位，并且至少有标识出当前帧所属的流的标识符，帧承载着特定类型的数据，如HTTP首部、负荷、等等
 - 消息：比帧大的通讯单位，是指逻辑上的HTTP消息，比如请求、响应等。由一个或多个帧组成
 - 流：比消息大的通讯单位。是TCP连接中的一个虚拟通道，可以承载双向的消息。每个流都有一个唯一的整数标识符  

HTTP2.0会把所有信息分割成更小的消息和帧，并采用二进制格式将其封装。例如header封装到Headers帧，request body封装到Data帧。  
HTTP2.0通信都在一个TCP连接上完成，这个连接可以承载任意数量的双向数据流，相应的每个数据流以消息的形式发送。而消息由一或多个帧组成，这些帧可以乱序发送，然后根据每个帧首部的流标识符重新组装。

***

### 多路复用
在HTTP/1.X中，用户可以通过并行请求多个接口来提高效率，但是这需要建立多个单独的TCP连接，且单个页面可同时发送的请求数有限。  
在HTTP2.0中，采用了二进制帧层技术，即允许客户端和服务端把HTTP消息分解成独立的帧，交错传输，然后在另一端组装。
![](/img/http2-1.jpg)
多路复用有以下作用：
 - 可同时进行多个请求而不会堵塞
 - 使用一个连接进行所有的请求
 - 移除了HTTP/1.X中级联文件、域分片等技术

***
### 服务端推送
服务端推送的意思是除了对原始请求的响应外，服务器还可以向客户端推送额外的数据。服务端推送有以下优势：
 - 推送的资源可以由客户端缓存
 - 推送的资源可以在不同的页面上重复使用
 - 推送的资源可以与其他资源一起复用
 - 推送的资源可以由服务器优先
 - 推送的资源可以被客户拒绝

***
### 头部压缩
HTTP1.x每次通讯（请求或响应）都会携带首部信息用于描述资源属性。而HTTP2.0在客户端和服务端之间使用首部表来跟踪和存储之前发送的键值对。请求与响应首部的定义在HTTP2.0中基本没有变，只是所有首部键必须全部小写，而且要求行要独立为:method:、:scheme:、:host:、:path:这些键值对  
对于相同的数据，不再重新通过每次请求和响应发送。每个新的首部键值对要么追加到当前表的末尾，要么替换表中之前的值。首部表在HTTP2.0的链接存续期内始终存在，由客户端和服务端共同渐进的更新。  

